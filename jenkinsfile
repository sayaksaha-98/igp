pipeline {
	agent any
	stages {
		stage('Code Checkout') {
			steps {
				git 'https://github.com/sayaksaha-98/igp.git'
			}
		}
		stage('Code Compile') {
			steps {
				sh 'mvn compile'
			}
		}
		stage('Unit Test') {
			steps {
				sh 'mvn test'
			}
		}
		stage('Code Packaging') {
			steps {
				sh 'mvn package'
			}
		}
		stage('Build Docker Image') {
			steps {
				sh 'cp /var/lib/jenkins/workspace/$JOB_NAME/target/ABCtechnologies-1.0.war /var/lib/jenkins/workspace/$JOB_NAME/abc.war'
				sh 'docker build -t sayaksaha98/abc_tech:$BUILD_NUMBER .'
			}
		}
		stage('Push Docker Image') {
			steps {
				withDockerRegistry([ credentialsId: "dockerhub", url: "" ])
				{
					sh 'docker push sayaksaha98/abc_tech:$BUILD_NUMBER'
				}
			}
		}
		stage('Deploy as Container') {
			steps {
				sh 'docker run -itd -P sayaksaha98/abc_tech:$BUILD_NUMBER'
			}
		}
	}
}